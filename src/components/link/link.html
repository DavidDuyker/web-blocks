<template id="wc-link-template">
  <style>
    :host {
      --link-color: var(--color-primary, #0066ff);
      --link-color-hover: var(--color-primary-hover, #0056d6);
      --corner-color: var(--hover-corners, var(--link-color));
    }

    .link {
      position: relative;
      display: inline-block;
      color: var(--link-color);
      text-decoration: underline;
      text-underline-offset: 2px;
      text-decoration-thickness: 2px;
      cursor: pointer;
      font: inherit;
      background: none;
      border: 0;
      padding: 0;
      transition: color 200ms ease;
    }

    .link:hover,
    .link:focus {
      color: var(--link-color-hover);
      outline: none;
    }

    /* inline variant: minimalist underline that tightens on hover */
    .link--inline {
      text-decoration: underline;
    }

    /* crosshair variant: animated corner lines on hover/focus */
    .CornerLinesWrapper {
      position: absolute;
      top: -2px;
      left: -2px;
      width: calc(100% + 4px);
      height: calc(100% + 4px);
      pointer-events: none;
      opacity: 0;
      transition: opacity 350ms ease;
    }

    .link--crosshair:hover .CornerLinesWrapper,
    .link--crosshair:focus .CornerLinesWrapper {
      opacity: 1;
    }

    .CornerLinesWrapper span {
      position: absolute;
      border: 1px solid var(--corner-color);
      width: 8px;
      height: 8px;
    }

    .CornerLinesTopLeft { top: -1px; left: -1px; border-bottom: none; border-right: none; border-top-left-radius: 4px; }
    .CornerLinesTopRight { top: -1px; right: -1px; border-bottom: none; border-left: none; border-top-right-radius: 4px; }
    .CornerLinesBottomLeft { bottom: -1px; left: -1px; border-top: none; border-right: none; border-bottom-left-radius: 4px; }
    .CornerLinesBottomRight { bottom: -1px; right: -1px; border-top: none; border-left: none; border-bottom-right-radius: 4px; }
  </style>

  <a class="link link--inline"><slot></slot></a>
</template>

<script>
class WcLink extends HTMLElement {
  static get observedAttributes() {
    return ['href', 'target', 'variant'];
  }

  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    this.shadowRoot.appendChild(
      document.getElementById('wc-link-template').content.cloneNode(true)
    );
  }

  connectedCallback() {
    this.updateLink();
    this.setupCornerLines();
  }

  attributeChangedCallback() {
    this.updateLink();
  }

  updateLink() {
    const link = this.shadowRoot.querySelector('.link');
    const href = this.getAttribute('href');
    const target = this.getAttribute('target');
    const variant = (this.getAttribute('variant') || 'inline').toLowerCase();

    // classes
    const classes = ['link'];
    if (variant === 'crosshair') {
      classes.push('link--crosshair');
    } else {
      classes.push('link--inline');
    }
    link.className = classes.join(' ');

    // attributes
    if (href) link.href = href;
    if (target) link.target = target;
  }

  setupCornerLines() {
    const link = this.shadowRoot.querySelector('.link');
    if (this.shadowRoot.querySelector('.CornerLinesWrapper')) return;

    const wrapper = document.createElement('div');
    wrapper.className = 'CornerLinesWrapper';

    const tl = document.createElement('span'); tl.className = 'CornerLinesTopLeft';
    const tr = document.createElement('span'); tr.className = 'CornerLinesTopRight';
    const bl = document.createElement('span'); bl.className = 'CornerLinesBottomLeft';
    const br = document.createElement('span'); br.className = 'CornerLinesBottomRight';

    wrapper.appendChild(tl);
    wrapper.appendChild(tr);
    wrapper.appendChild(bl);
    wrapper.appendChild(br);

    link.appendChild(wrapper);
  }
}

customElements.define('wc-link', WcLink);
</script>


